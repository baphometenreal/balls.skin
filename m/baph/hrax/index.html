<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hrax Investigator</title>
	<style>
		@font-face {font-family: "sanfran"; src: url("./sanfran.ttf");}
		@font-face {font-family: "Hrax"; src: url("./hrax.ttf")}
		
		hrax {font-family: "Hrax"; font-size:.65em;}
		
		table {
			height:100%;
			width:100%;
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
		}
		
		table, th, td {
		  font-family: "sanfran";
		  vertical-align: top;
		}
		
		th, td {
			background-color: #FFFFFF;
		}
		
		div {
			display: block;
			
			overflow:auto;
			width: 100%;
			height: 100%;
		}
		.data {
			width: 25%;
		}
		.fix{
			height: 0;
		}
		
		ul {
			margin: 0;
		}
		
		.selected {
			background-color: blue;
			color: white;
			border-radius: 5px;
			padding: 1px;
		}
		
		a {
			color: inherit;
			text-decoration: inherit;
		}
		.topbar {
			background-image: url(topbar.png);
			background-repeat: repeat-x;
			background-size: contain;
			padding: 2px;
			font-family: "sanfran";
			font-style: bold;
		}
		.icon {
			width: auto;
			height: 16px;
		}
		.finderheader {
			font-size: 1.3em;
		}
		a.hrax:hover {
			// color: white;
			border-radius: 2px;
			background-color: #f1807e;
		}
		.menu {
		  font-family: "sanfran";
		  font-size: 16px;
		  font-weight: normal;
		  text-align: start;
		
		  position: absolute;
		  z-index: 1;
		  width: fit-content;
		  min-width: 100px;
		  height: fit-content;
		  min-height: 1.2em;
		  
		  background-color: lightgrey;
		  border: 1px solid grey;
		  border-radius: 5px;
		  padding: 1px;
		}
		
		</style>
    <!-- <link href="/style.css" rel="stylesheet" type="text/css" media="all"> -->
  </head>
  <body>
	<table>
	  <tr style="height:1em;">
	   <td class="topbar" colspan="2"><img class="icon" src="./bean.png">  <b>pweeWorks File Edit View Go Window Settings</b></th>
	  </tr>
	  <tr style="height: 48%; max-height: 50%">
		<td class="data fix"><div id="filesystem">
			<img class="icon" src="./disk.png"> <text class="finderheader">Beanrod HDD</text>
			<ul>
				<li><a href="#" name="sysfile" id="readme" onclick="highlight(this)">README.TXT</font></li>
				<li><a href="#" name="sysfile" id="tykh" onclick="highlight(this)">TeachYourKidHrax.PDF</font></li>
			</ul> 
		</div></th>
		<td rowspan="2" style="border-left:6px solid grey; " class="fix"><div id="currdoc"><center><h2>pweeWorks 1.0</h2><h4>Copyright Winter Language Institute, 2001</h4><br><h4>Select a file to start working.</h4></center></div></th>
	  </tr>
	  <tr style="height: 52%; max-height: 50%;">
		<td class="fix" style="border-top:2px solid grey;"><div id="dictionary">No dictionary entries</div></td>
	  </tr>
	</table>
	<script>
		window.onresize = function() {
			var menuOld = document.getElementsByClassName("menu")
			
			for (let i = 0; i < menuOld.length; i++)
			{ menuOld[i].remove() }
		}
		
		document.addEventListener('click', (event) => {
		  const target = document.getElementsByClassName("menu")
		  const target2 = document.getElementsByTagName("a")
		  
		  if (target.length == 0 || event.composedPath()[0].className == "hrax") {return}
		  
		  const withinBoundaries = event.composedPath().includes(target[0])

		  if (!withinBoundaries) {
			target[0].remove()
		  }
		})
		
		function lookUpHrax(clicked) {
			//console.log(clicked)
			var menuOld = document.getElementsByClassName("menu")
			
			for (let i = 0; i < menuOld.length; i++)
			{ menuOld[i].remove() }
			
			var leftPos = ((Math.min(window.innerWidth - 105, clicked.offsetLeft + document.getElementById("currdoc").getBoundingClientRect().x) - 1) / window.innerWidth) * 100
			
			word = clicked.innerHTML.toLowerCase()
			
			clicked.parentElement.outerHTML += '<div class="menu"><b><i>' + word + '</b></i><br>Menu 1<br>Menu 2</div>'
			
			var menu = document.getElementsByClassName("menu")[0]
			//console.log(menu)
			
			menu.style.left = leftPos+'%';
			//console.log(word)
		}
		
		function parseHrax() {
			var hraxTexts = document.getElementById("currdoc").getElementsByTagName("hrax")
			
			for (let i = 0; i < hraxTexts.length; i++) {
				var innerText = hraxTexts[i].innerHTML
				
				const regex = /\b(\w+)\b/ig;
				innerText = innerText.replaceAll(/\b(\w+)\b/ig, '<a href="#" class="hrax" onclick="lookUpHrax(this)">$1</a>')
				
				hraxTexts[i].innerHTML = innerText
			}
		}
		
		
		function highlight(clicked) {
			var allLinks = document.getElementsByName("sysfile")
			
			for (let i = 0; i < allLinks.length; i++) {
				allLinks[i].className = "";
			}
			
			clicked.className = "selected"
			
			var currdoc = document.getElementById("currdoc")
			
			currdoc.innerHTML = "Loading <b>" + clicked.innerHTML + "</b>..."
			
			fetch('./files/' + clicked.id + '.txt')
			  .then(response => response.text())
			  .then((data) => {
				currdoc.innerHTML = data
			  })
			  .then(() => parseHrax())
		}
	
	</script>
  </body>
</html>
